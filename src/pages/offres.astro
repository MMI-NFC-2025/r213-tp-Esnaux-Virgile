---
import "../styles/global.css";
import Layout from "../layouts/Layout.astro";
import OffreCard from "../components/OffreCard.astro";
import image1 from "../assets/image1.png";
import image2 from "../assets/image2.jpg";
import image3 from "../assets/image3.jpg";

const offres = [
    {
        adresse: "2821 Lake Sevilla, Palm Harbor, TX",
        favori: true,
        id: "6413n8nar83615j",
        nbChambres: 4,
        nbSdb: 2,
        nomMaison: "Beverly Springfield",
        prix: 2700,
        surface: 45,
        imgUrl: image1.src,
    },
    {
        adresse: "2699 Green Valley, Highland Lake",
        favori: true,
        id: "lo831zeg10hpm9y",
        nbChambres: 4,
        nbSdb: 2,
        nomMaison: "Palm Harbor",
        prix: 2895,
        surface: 42,
        imgUrl: image2.src,
    },
    {
        adresse: "909 Woodland St, Michigan, IN",
        favori: false,
        id: "s1zuhjl9x8eb242",
        nbChambres: 4,
        nbSdb: 3,
        nomMaison: "Faulkner Ave",
        prix: 4550,
        surface: 80,
        imgUrl: image3.src,
    },
];
---

<Layout title="Offres">
    <h1>Hello, voici les offres!</h1>
    <button id="favori-button" class="bg-slate-600 rounded-lg text-white p-2">
        Afficher les favoris
    </button>
    <div class="offres-container">
        {
            offres.map((offre) => (
                <div class="offre" data-favori={offre.favori.toString()}>
                    <OffreCard {...offre} />
                </div>
            ))
        }
    </div>
</Layout>

<script>
    const button = document.getElementById("favori-button");
    let showOnlyFavorites = false;
    button?.addEventListener("click", () => {
        showOnlyFavorites = !showOnlyFavorites;
        const offres = document.querySelectorAll(".offre");

        button.textContent = showOnlyFavorites
            ? "Afficher tout"
            : "Afficher les favoris";

        offres.forEach((offre) => {
            const isFavori = offre.getAttribute("data-favori") === "true";
            offre.classList.toggle("hidden", showOnlyFavorites && !isFavori);
        });
    });

    // Gestion des boutons favoris sur chaque card
    const favoriBtns = document.querySelectorAll(".favori-btn");
    favoriBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            const isFavori = btn.getAttribute("data-favori") === "true";
            const newFavori = !isFavori;

            btn.setAttribute("data-favori", newFavori.toString());
            btn.textContent = newFavori ? "⭐ Favori" : "☆ Favori";

            // Mettre à jour l'apparence de la card
            const offreCard = btn.closest(".offre-card");
            if (offreCard) {
                offreCard.classList.toggle("favori", newFavori);
            }

            // Mettre à jour l'attribut data-favori du conteneur parent
            const offreContainer = btn.closest(".offre");
            if (offreContainer) {
                offreContainer.setAttribute(
                    "data-favori",
                    newFavori.toString(),
                );

                // Si le filtre est actif, cacher la card si elle n'est plus favorite
                if (showOnlyFavorites && !newFavori) {
                    offreContainer.classList.add("hidden");
                }
            }
        });
    });
</script>

<style>
    .offres-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        justify-items: center;
    }

    .offre {
        display: flex;
        width: 100%;
        max-width: 400px;
    }

    .offre.hidden {
        display: none;
    }
</style>
